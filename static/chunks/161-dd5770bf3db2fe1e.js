"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[161],{161:function(e,t,n){n.a(e,async function(e,r){try{let e;n.d(t,{s_:function(){return Y}});var i=n(4926).Buffer;let Z=0x7fffffffffffffff-1,P=Object.freeze({double:1,string:2,object:3,array:4,binData:5,undefined:6,objectId:7,bool:8,date:9,null:10,regex:11,dbPointer:12,javascript:13,symbol:14,javascriptWithScope:15,int:16,timestamp:17,long:18,decimal:19,minKey:-1,maxKey:127});class K extends Error{get bsonError(){return!0}get name(){return"BSONError"}constructor(e){super(e)}static isBSONError(e){return null!=e&&"object"==typeof e&&"bsonError"in e&&!0===e.bsonError&&"name"in e&&"message"in e&&"stack"in e}}class W extends K{get name(){return"BSONVersionError"}constructor(){super("Unsupported BSON version, bson types must be from bson 5.0 or later")}}class G extends K{get name(){return"BSONRuntimeError"}constructor(e){super(e)}}function o(e){return Q.fromNumberArray(Array.from({length:e},()=>Math.floor(256*Math.random())))}let X=await (async()=>{try{return(await Promise.all([n.e(431),n.e(463)]).then(n.t.bind(n,618,19))).randomBytes}catch{return o}})(),Q={toLocalBufferType(e){if(i.isBuffer(e))return e;if(ArrayBuffer.isView(e))return i.from(e.buffer,e.byteOffset,e.byteLength);let t=e?.[Symbol.toStringTag]??Object.prototype.toString.call(e);if("ArrayBuffer"===t||"SharedArrayBuffer"===t||"[object ArrayBuffer]"===t||"[object SharedArrayBuffer]"===t)return i.from(e);throw new K(`Cannot create Buffer from ${String(e)}`)},allocate:e=>i.alloc(e),equals:(e,t)=>Q.toLocalBufferType(e).equals(t),fromNumberArray:e=>i.from(e),fromBase64:e=>i.from(e,"base64"),toBase64:e=>Q.toLocalBufferType(e).toString("base64"),fromISO88591:e=>i.from(e,"binary"),toISO88591:e=>Q.toLocalBufferType(e).toString("binary"),fromHex:e=>i.from(e,"hex"),toHex:e=>Q.toLocalBufferType(e).toString("hex"),fromUTF8:e=>i.from(e,"utf8"),toUTF8:e=>Q.toLocalBufferType(e).toString("utf8"),utf8ByteLength:e=>i.byteLength(e,"utf8"),encodeUTF8Into:(e,t,n)=>Q.toLocalBufferType(e).write(t,n,void 0,"utf8"),randomBytes:X};function s(e){if(e<0)throw RangeError(`The argument 'byteLength' is invalid. Received ${e}`);return en.fromNumberArray(Array.from({length:e},()=>Math.floor(256*Math.random())))}let ee=(()=>{let{crypto:e}=globalThis;if(null!=e&&"function"==typeof e.getRandomValues)return t=>e.getRandomValues(en.allocate(t));if(function(){let{navigator:e}=globalThis;return"object"==typeof e&&"ReactNative"===e.product}()){let{console:e}=globalThis;e?.warn?.("BSON: For React Native please polyfill crypto.getRandomValues, e.g. using: https://www.npmjs.com/package/react-native-get-random-values.")}return s})(),et=/(\d|[a-f])/i,en={toLocalBufferType(e){let t=e?.[Symbol.toStringTag]??Object.prototype.toString.call(e);if("Uint8Array"===t)return e;if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength));if("ArrayBuffer"===t||"SharedArrayBuffer"===t||"[object ArrayBuffer]"===t||"[object SharedArrayBuffer]"===t)return new Uint8Array(e);throw new K(`Cannot make a Uint8Array from ${String(e)}`)},allocate(e){if("number"!=typeof e)throw TypeError(`The "size" argument must be of type number. Received ${String(e)}`);return new Uint8Array(e)},equals(e,t){if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0},fromNumberArray:e=>Uint8Array.from(e),fromBase64:e=>Uint8Array.from(atob(e),e=>e.charCodeAt(0)),toBase64:e=>btoa(en.toISO88591(e)),fromISO88591:e=>Uint8Array.from(e,e=>255&e.charCodeAt(0)),toISO88591:e=>Array.from(Uint16Array.from(e),e=>String.fromCharCode(e)).join(""),fromHex(e){let t=e.length%2==0?e:e.slice(0,e.length-1),n=[];for(let e=0;e<t.length;e+=2){let r=t[e],i=t[e+1];if(!et.test(r)||!et.test(i))break;let o=Number.parseInt(`${r}${i}`,16);n.push(o)}return Uint8Array.from(n)},toHex:e=>Array.from(e,e=>e.toString(16).padStart(2,"0")).join(""),fromUTF8:e=>new TextEncoder().encode(e),toUTF8:e=>new TextDecoder("utf8",{fatal:!1}).decode(e),utf8ByteLength:e=>en.fromUTF8(e).byteLength,encodeUTF8Into(e,t,n){let r=en.fromUTF8(t);return e.set(r,n),r.byteLength},randomBytes:ee},er="function"==typeof i&&i.prototype?._isBuffer!==!0,ei=er?Q:en;class eo extends DataView{static fromUint8Array(e){return new DataView(e.buffer,e.byteOffset,e.byteLength)}}let es=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|[0-9a-f]{12}4[0-9a-f]{3}[89ab][0-9a-f]{15})$/i,el=e=>"string"==typeof e&&es.test(e),ef=e=>{if(!el(e))throw new K('UUID string representations must be a 32 or 36 character hex string (dashes excluded/included). Format: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" or "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".');let t=e.replace(/-/g,"");return ei.fromHex(t)};function l(e,t=!0){return t?[ei.toHex(e.subarray(0,4)),ei.toHex(e.subarray(4,6)),ei.toHex(e.subarray(6,8)),ei.toHex(e.subarray(8,10)),ei.toHex(e.subarray(10,16))].join("-"):ei.toHex(e)}function f(e){return["[object ArrayBuffer]","[object SharedArrayBuffer]"].includes(Object.prototype.toString.call(e))}function u(e){return"[object Uint8Array]"===Object.prototype.toString.call(e)}function a(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function h(e){return"[object Map]"===Object.prototype.toString.call(e)}function g(e){return"[object Date]"===Object.prototype.toString.call(e)}class eu{get[Symbol.for("@@mdb.bson.version")](){return 5}}class ea extends eu{get _bsontype(){return"Binary"}constructor(e,t){if(super(),null!=e&&"string"!=typeof e&&!ArrayBuffer.isView(e)&&!(e instanceof ArrayBuffer)&&!Array.isArray(e))throw new K("Binary can only be constructed from string, Buffer, TypedArray, or Array<number>");this.sub_type=t??ea.BSON_BINARY_SUBTYPE_DEFAULT,null==e?(this.buffer=ei.allocate(ea.BUFFER_SIZE),this.position=0):("string"==typeof e?this.buffer=ei.fromISO88591(e):Array.isArray(e)?this.buffer=ei.fromNumberArray(e):this.buffer=ei.toLocalBufferType(e),this.position=this.buffer.byteLength)}put(e){let t;if("string"==typeof e&&1!==e.length)throw new K("only accepts single character String");if("number"!=typeof e&&1!==e.length)throw new K("only accepts single character Uint8Array or Array");if((t="string"==typeof e?e.charCodeAt(0):"number"==typeof e?e:e[0])<0||t>255)throw new K("only accepts number in a valid unsigned byte range 0-255");if(this.buffer.byteLength>this.position)this.buffer[this.position++]=t;else{let e=ei.allocate(ea.BUFFER_SIZE+this.buffer.length);e.set(this.buffer,0),this.buffer=e,this.buffer[this.position++]=t}}write(e,t){if(t="number"==typeof t?t:this.position,this.buffer.byteLength<t+e.length){let t=ei.allocate(this.buffer.byteLength+e.length);t.set(this.buffer,0),this.buffer=t}if(ArrayBuffer.isView(e))this.buffer.set(ei.toLocalBufferType(e),t),this.position=t+e.byteLength>this.position?t+e.length:this.position;else if("string"==typeof e){let n=ei.fromISO88591(e);this.buffer.set(n,t),this.position=t+e.length>this.position?t+e.length:this.position}}read(e,t){return t=t&&t>0?t:this.position,this.buffer.slice(e,e+t)}value(e){return(e=!!e)&&this.buffer.length===this.position?this.buffer:e?this.buffer.slice(0,this.position):ei.toISO88591(this.buffer.subarray(0,this.position))}length(){return this.position}toJSON(){return ei.toBase64(this.buffer)}toString(e){return"hex"===e?ei.toHex(this.buffer):"base64"===e?ei.toBase64(this.buffer):ei.toUTF8(this.buffer)}toExtendedJSON(e){e=e||{};let t=ei.toBase64(this.buffer),n=Number(this.sub_type).toString(16);return e.legacy?{$binary:t,$type:1===n.length?"0"+n:n}:{$binary:{base64:t,subType:1===n.length?"0"+n:n}}}toUUID(){if(this.sub_type===ea.SUBTYPE_UUID)return new eh(this.buffer.slice(0,this.position));throw new K(`Binary sub_type "${this.sub_type}" is not supported for converting to UUID. Only "${ea.SUBTYPE_UUID}" is currently supported.`)}static createFromHexString(e,t){return new ea(ei.fromHex(e),t)}static createFromBase64(e,t){return new ea(ei.fromBase64(e),t)}static fromExtendedJSON(e,t){let n,r;if(t=t||{},"$binary"in e?t.legacy&&"string"==typeof e.$binary&&"$type"in e?(r=e.$type?parseInt(e.$type,16):0,n=ei.fromBase64(e.$binary)):"string"!=typeof e.$binary&&(r=e.$binary.subType?parseInt(e.$binary.subType,16):0,n=ei.fromBase64(e.$binary.base64)):"$uuid"in e&&(r=4,n=ef(e.$uuid)),!n)throw new K(`Unexpected Binary Extended JSON format ${JSON.stringify(e)}`);return 4===r?new eh(n):new ea(n,r)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){let e=ei.toBase64(this.buffer.subarray(0,this.position));return`Binary.createFromBase64("${e}", ${this.sub_type})`}}ea.BSON_BINARY_SUBTYPE_DEFAULT=0,ea.BUFFER_SIZE=256,ea.SUBTYPE_DEFAULT=0,ea.SUBTYPE_FUNCTION=1,ea.SUBTYPE_BYTE_ARRAY=2,ea.SUBTYPE_UUID_OLD=3,ea.SUBTYPE_UUID=4,ea.SUBTYPE_MD5=5,ea.SUBTYPE_ENCRYPTED=6,ea.SUBTYPE_COLUMN=7,ea.SUBTYPE_USER_DEFINED=128;class eh extends ea{constructor(e){let t,n;if(null==e)t=eh.generate();else if(e instanceof eh)t=ei.toLocalBufferType(new Uint8Array(e.buffer)),n=e.__id;else if(ArrayBuffer.isView(e)&&16===e.byteLength)t=ei.toLocalBufferType(e);else if("string"==typeof e)t=ef(e);else throw new K("Argument passed in UUID constructor must be a UUID, a 16 byte Buffer or a 32/36 character hex string (dashes excluded/included, format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx).");super(t,4),this.__id=n}get id(){return this.buffer}set id(e){this.buffer=e,eh.cacheHexString&&(this.__id=l(e))}toHexString(e=!0){if(eh.cacheHexString&&this.__id)return this.__id;let t=l(this.id,e);return eh.cacheHexString&&(this.__id=t),t}toString(e){return"hex"===e?ei.toHex(this.id):"base64"===e?ei.toBase64(this.id):this.toHexString()}toJSON(){return this.toHexString()}equals(e){if(!e)return!1;if(e instanceof eh)return ei.equals(e.id,this.id);try{return ei.equals(new eh(e).id,this.id)}catch{return!1}}toBinary(){return new ea(this.id,ea.SUBTYPE_UUID)}static generate(){let e=ei.randomBytes(16);return e[6]=15&e[6]|64,e[8]=63&e[8]|128,e}static isValid(e){return!!e&&(e instanceof eh||("string"==typeof e?el(e):!!u(e)&&16===e.byteLength&&(240&e[6])==64&&(128&e[8])==128))}static createFromHexString(e){let t=ef(e);return new eh(t)}static createFromBase64(e){return new eh(ei.fromBase64(e))}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new UUID("${this.toHexString()}")`}}class eg extends eu{get _bsontype(){return"Code"}constructor(e,t){super(),this.code=e.toString(),this.scope=t??null}toJSON(){return null!=this.scope?{code:this.code,scope:this.scope}:{code:this.code}}toExtendedJSON(){return this.scope?{$code:this.code,$scope:this.scope}:{$code:this.code}}static fromExtendedJSON(e){return new eg(e.$code,e.$scope)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){let e=this.toJSON();return`new Code("${String(e.code)}"${null!=e.scope?`, ${JSON.stringify(e.scope)}`:""})`}}function c(e){return null!=e&&"object"==typeof e&&"$id"in e&&null!=e.$id&&"$ref"in e&&"string"==typeof e.$ref&&(!("$db"in e)||"$db"in e&&"string"==typeof e.$db)}class ec extends eu{get _bsontype(){return"DBRef"}constructor(e,t,n,r){super();let i=e.split(".");2===i.length&&(n=i.shift(),e=i.shift()),this.collection=e,this.oid=t,this.db=n,this.fields=r||{}}get namespace(){return this.collection}set namespace(e){this.collection=e}toJSON(){let e=Object.assign({$ref:this.collection,$id:this.oid},this.fields);return null!=this.db&&(e.$db=this.db),e}toExtendedJSON(e){e=e||{};let t={$ref:this.collection,$id:this.oid};return e.legacy?t:(this.db&&(t.$db=this.db),t=Object.assign(t,this.fields))}static fromExtendedJSON(e){let t=Object.assign({},e);return delete t.$ref,delete t.$id,delete t.$db,new ec(e.$ref,e.$id,e.$db,t)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){let e=void 0===this.oid||void 0===this.oid.toString?this.oid:this.oid.toString();return`new DBRef("${this.namespace}", new ObjectId("${String(e)}")${this.db?`, "${this.db}"`:""})`}}try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}let eb=0x7fffffffffffffff,ed={},em={},ep=/^(\+?0|(\+|-)?[1-9][0-9]*)$/;class ey extends eu{get _bsontype(){return"Long"}get __isLong__(){return!0}constructor(e=0,t,n){super(),"bigint"==typeof e?Object.assign(this,ey.fromBigInt(e,!!t)):"string"==typeof e?Object.assign(this,ey.fromString(e,!!t)):(this.low=0|e,this.high=0|t,this.unsigned=!!n)}static fromBits(e,t,n){return new ey(e,t,n)}static fromInt(e,t){let n,r,i;return t?(e>>>=0,(i=0<=e&&e<256)&&(r=em[e]))?r:(n=ey.fromBits(e,(0|e)<0?-1:0,!0),i&&(em[e]=n),n):(e|=0,(i=-128<=e&&e<128)&&(r=ed[e]))?r:(n=ey.fromBits(e,e<0?-1:0,!1),i&&(ed[e]=n),n)}static fromNumber(e,t){if(isNaN(e))return t?ey.UZERO:ey.ZERO;if(t){if(e<0)return ey.UZERO;if(e>=18446744073709552e3)return ey.MAX_UNSIGNED_VALUE}else{if(e<=-eb)return ey.MIN_VALUE;if(e+1>=eb)return ey.MAX_VALUE}return e<0?ey.fromNumber(-e,t).neg():ey.fromBits(e%4294967296|0,e/4294967296|0,t)}static fromBigInt(e,t){return ey.fromString(e.toString(),t)}static fromString(e,t,n){let r;if(0===e.length)throw new K("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return ey.ZERO;if("number"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw new K("radix");if((r=e.indexOf("-"))>0)throw new K("interior hyphen");if(0===r)return ey.fromString(e.substring(1),t,n).neg();let i=ey.fromNumber(Math.pow(n,8)),o=ey.ZERO;for(let t=0;t<e.length;t+=8){let r=Math.min(8,e.length-t),s=parseInt(e.substring(t,t+r),n);if(r<8){let e=ey.fromNumber(Math.pow(n,r));o=o.mul(e).add(ey.fromNumber(s))}else o=(o=o.mul(i)).add(ey.fromNumber(s))}return o.unsigned=t,o}static fromBytes(e,t,n){return n?ey.fromBytesLE(e,t):ey.fromBytesBE(e,t)}static fromBytesLE(e,t){return new ey(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)}static fromBytesBE(e,t){return new ey(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}static isLong(e){return null!=e&&"object"==typeof e&&"__isLong__"in e&&!0===e.__isLong__}static fromValue(e,t){return"number"==typeof e?ey.fromNumber(e,t):"string"==typeof e?ey.fromString(e,t):ey.fromBits(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}add(e){ey.isLong(e)||(e=ey.fromValue(e));let t=this.high>>>16,n=65535&this.high,r=this.low>>>16,i=65535&this.low,o=e.high>>>16,s=65535&e.high,l=e.low>>>16,f=65535&e.low,u=0,a=0,h=0,g;return g=0+(i+f),h+=g>>>16,g&=65535,h+=r+l,a+=h>>>16,h&=65535,a+=n+s,u+=a>>>16,a&=65535,u+=t+o,u&=65535,ey.fromBits(h<<16|g,u<<16|a,this.unsigned)}and(e){return ey.isLong(e)||(e=ey.fromValue(e)),ey.fromBits(this.low&e.low,this.high&e.high,this.unsigned)}compare(e){if(ey.isLong(e)||(e=ey.fromValue(e)),this.eq(e))return 0;let t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1}comp(e){return this.compare(e)}divide(t){let n,r,i;if(ey.isLong(t)||(t=ey.fromValue(t)),t.isZero())throw new K("division by zero");if(e){if(!this.unsigned&&-2147483648===this.high&&-1===t.low&&-1===t.high)return this;let n=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,t.low,t.high);return ey.fromBits(n,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?ey.UZERO:ey.ZERO;if(this.unsigned){if(t.unsigned||(t=t.toUnsigned()),t.gt(this))return ey.UZERO;if(t.gt(this.shru(1)))return ey.UONE;i=ey.UZERO}else{if(this.eq(ey.MIN_VALUE)){if(t.eq(ey.ONE)||t.eq(ey.NEG_ONE))return ey.MIN_VALUE;{if(t.eq(ey.MIN_VALUE))return ey.ONE;let e=this.shr(1);return(n=e.div(t).shl(1)).eq(ey.ZERO)?t.isNegative()?ey.ONE:ey.NEG_ONE:(r=this.sub(t.mul(n)),i=n.add(r.div(t)))}}if(t.eq(ey.MIN_VALUE))return this.unsigned?ey.UZERO:ey.ZERO;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();i=ey.ZERO}for(r=this;r.gte(t);){n=Math.max(1,Math.floor(r.toNumber()/t.toNumber()));let e=Math.ceil(Math.log(n)/Math.LN2),o=e<=48?1:Math.pow(2,e-48),s=ey.fromNumber(n),l=s.mul(t);for(;l.isNegative()||l.gt(r);)n-=o,l=(s=ey.fromNumber(n,this.unsigned)).mul(t);s.isZero()&&(s=ey.ONE),i=i.add(s),r=r.sub(l)}return i}div(e){return this.divide(e)}equals(e){return ey.isLong(e)||(e=ey.fromValue(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low}eq(e){return this.equals(e)}getHighBits(){return this.high}getHighBitsUnsigned(){return this.high>>>0}getLowBits(){return this.low}getLowBitsUnsigned(){return this.low>>>0}getNumBitsAbs(){let e;if(this.isNegative())return this.eq(ey.MIN_VALUE)?64:this.neg().getNumBitsAbs();let t=0!==this.high?this.high:this.low;for(e=31;e>0&&(t&1<<e)==0;e--);return 0!==this.high?e+33:e+1}greaterThan(e){return this.comp(e)>0}gt(e){return this.greaterThan(e)}greaterThanOrEqual(e){return this.comp(e)>=0}gte(e){return this.greaterThanOrEqual(e)}ge(e){return this.greaterThanOrEqual(e)}isEven(){return(1&this.low)==0}isNegative(){return!this.unsigned&&this.high<0}isOdd(){return(1&this.low)==1}isPositive(){return this.unsigned||this.high>=0}isZero(){return 0===this.high&&0===this.low}lessThan(e){return 0>this.comp(e)}lt(e){return this.lessThan(e)}lessThanOrEqual(e){return 0>=this.comp(e)}lte(e){return this.lessThanOrEqual(e)}modulo(t){if(ey.isLong(t)||(t=ey.fromValue(t)),e){let n=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,t.low,t.high);return ey.fromBits(n,e.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))}mod(e){return this.modulo(e)}rem(e){return this.modulo(e)}multiply(t){if(this.isZero())return ey.ZERO;if(ey.isLong(t)||(t=ey.fromValue(t)),e){let n=e.mul(this.low,this.high,t.low,t.high);return ey.fromBits(n,e.get_high(),this.unsigned)}if(t.isZero())return ey.ZERO;if(this.eq(ey.MIN_VALUE))return t.isOdd()?ey.MIN_VALUE:ey.ZERO;if(t.eq(ey.MIN_VALUE))return this.isOdd()?ey.MIN_VALUE:ey.ZERO;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(ey.TWO_PWR_24)&&t.lt(ey.TWO_PWR_24))return ey.fromNumber(this.toNumber()*t.toNumber(),this.unsigned);let n=this.high>>>16,r=65535&this.high,i=this.low>>>16,o=65535&this.low,s=t.high>>>16,l=65535&t.high,f=t.low>>>16,u=65535&t.low,a=0,h=0,g=0,c;return c=0+o*u,g+=c>>>16,c&=65535,g+=i*u,h+=g>>>16,g&=65535,g+=o*f,h+=g>>>16,g&=65535,h+=r*u,a+=h>>>16,h&=65535,h+=i*f,a+=h>>>16,h&=65535,h+=o*l,a+=h>>>16,h&=65535,a+=n*u+r*f+i*l+o*s,a&=65535,ey.fromBits(g<<16|c,a<<16|h,this.unsigned)}mul(e){return this.multiply(e)}negate(){return!this.unsigned&&this.eq(ey.MIN_VALUE)?ey.MIN_VALUE:this.not().add(ey.ONE)}neg(){return this.negate()}not(){return ey.fromBits(~this.low,~this.high,this.unsigned)}notEquals(e){return!this.equals(e)}neq(e){return this.notEquals(e)}ne(e){return this.notEquals(e)}or(e){return ey.isLong(e)||(e=ey.fromValue(e)),ey.fromBits(this.low|e.low,this.high|e.high,this.unsigned)}shiftLeft(e){return(ey.isLong(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?ey.fromBits(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):ey.fromBits(0,this.low<<e-32,this.unsigned)}shl(e){return this.shiftLeft(e)}shiftRight(e){return(ey.isLong(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?ey.fromBits(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):ey.fromBits(this.high>>e-32,this.high>=0?0:-1,this.unsigned)}shr(e){return this.shiftRight(e)}shiftRightUnsigned(e){if(ey.isLong(e)&&(e=e.toInt()),e&=63,0===e)return this;{let t=this.high;if(e<32){let n=this.low;return ey.fromBits(n>>>e|t<<32-e,t>>>e,this.unsigned)}return 32===e?ey.fromBits(t,0,this.unsigned):ey.fromBits(t>>>e-32,0,this.unsigned)}}shr_u(e){return this.shiftRightUnsigned(e)}shru(e){return this.shiftRightUnsigned(e)}subtract(e){return ey.isLong(e)||(e=ey.fromValue(e)),this.add(e.neg())}sub(e){return this.subtract(e)}toInt(){return this.unsigned?this.low>>>0:this.low}toNumber(){return this.unsigned?(this.high>>>0)*4294967296+(this.low>>>0):4294967296*this.high+(this.low>>>0)}toBigInt(){return BigInt(this.toString())}toBytes(e){return e?this.toBytesLE():this.toBytesBE()}toBytesLE(){let e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]}toBytesBE(){let e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]}toSigned(){return this.unsigned?ey.fromBits(this.low,this.high,!1):this}toString(e){if((e=e||10)<2||36<e)throw new K("radix");if(this.isZero())return"0";if(this.isNegative()){if(!this.eq(ey.MIN_VALUE))return"-"+this.neg().toString(e);{let t=ey.fromNumber(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}}let t=ey.fromNumber(Math.pow(e,6),this.unsigned),n=this,r="";for(;;){let i=n.div(t),o=n.sub(i.mul(t)).toInt()>>>0,s=o.toString(e);if((n=i).isZero())return s+r;for(;s.length<6;)s="0"+s;r=""+s+r}}toUnsigned(){return this.unsigned?this:ey.fromBits(this.low,this.high,!0)}xor(e){return ey.isLong(e)||(e=ey.fromValue(e)),ey.fromBits(this.low^e.low,this.high^e.high,this.unsigned)}eqz(){return this.isZero()}le(e){return this.lessThanOrEqual(e)}toExtendedJSON(e){return e&&e.relaxed?this.toNumber():{$numberLong:this.toString()}}static fromExtendedJSON(e,t){let{useBigInt64:n=!1,relaxed:r=!0}={...t};if(e.$numberLong.length>20)throw new K("$numberLong string is too long");if(!ep.test(e.$numberLong))throw new K(`$numberLong string "${e.$numberLong}" is in an invalid format`);if(n){let t=BigInt(e.$numberLong);return BigInt.asIntN(64,t)}let i=ey.fromString(e.$numberLong);return r?i.toNumber():i}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new Long("${this.toString()}"${this.unsigned?", true":""})`}}ey.TWO_PWR_24=ey.fromInt(16777216),ey.MAX_UNSIGNED_VALUE=ey.fromBits(-1,-1,!0),ey.ZERO=ey.fromInt(0),ey.UZERO=ey.fromInt(0,!0),ey.ONE=ey.fromInt(1),ey.UONE=ey.fromInt(1,!0),ey.NEG_ONE=ey.fromInt(-1),ey.MAX_VALUE=ey.fromBits(-1,2147483647,!1),ey.MIN_VALUE=ey.fromBits(0,-2147483648,!1);let ew=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,ex=/^(\+|-)?(Infinity|inf)$/i,eS=/^(\+|-)?NaN$/i,eB=ei.fromNumberArray([124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse()),eN=ei.fromNumberArray([248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse()),eO=ei.fromNumberArray([120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse()),e_=/^([-+])?(\d+)?$/;function b(e){return!isNaN(parseInt(e,10))}function d(e,t){throw new K(`"${e}" is not a valid Decimal128 string - ${t}`)}class e$ extends eu{get _bsontype(){return"Decimal128"}constructor(e){if(super(),"string"==typeof e)this.bytes=e$.fromString(e).bytes;else if(u(e)){if(16!==e.byteLength)throw new K("Decimal128 must take a Buffer of 16 bytes");this.bytes=e}else throw new K("Decimal128 must take a Buffer or string")}static fromString(e){let t=!1,n=!1,r=!1,i=0,o=0,s=0,l=0,f=0,u=[0],a=0,h=0,g=0,c=0,m=0,p=0,y=new ey(0,0),w=new ey(0,0),x=0,S=0;if(e.length>=7e3)throw new K(""+e+" not a valid Decimal128 string");let B=e.match(ew),N=e.match(ex),O=e.match(eS);if(!B&&!N&&!O||0===e.length)throw new K(""+e+" not a valid Decimal128 string");if(B){let t=B[2],n=B[4],r=B[5],i=B[6];n&&void 0===i&&d(e,"missing exponent power"),n&&void 0===t&&d(e,"missing exponent base"),void 0===n&&(r||i)&&d(e,"missing e before exponent")}if(("+"===e[S]||"-"===e[S])&&(t="-"===e[S++]),!b(e[S])&&"."!==e[S]){if("i"===e[S]||"I"===e[S])return new e$(t?eN:eO);if("N"===e[S])return new e$(eB)}for(;b(e[S])||"."===e[S];){if("."===e[S]){n&&d(e,"contains multiple periods"),n=!0,S+=1;continue}a<34&&("0"!==e[S]||r)&&(r||(f=o),r=!0,u[h++]=parseInt(e[S],10),a+=1),r&&(s+=1),n&&(l+=1),o+=1,S+=1}if(n&&!o)throw new K(""+e+" not a valid Decimal128 string");if("e"===e[S]||"E"===e[S]){let t=e.substr(++S).match(e_);if(!t||!t[2])return new e$(eB);m=parseInt(t[0],10),S+=t[0].length}if(e[S])return new e$(eB);if(g=0,a){if(c=a-1,i=s,1!==i)for(;0===u[f+i-1];)i-=1}else g=0,c=0,u[0]=0,s=1,a=1,i=0;for(m<=l&&l-m>16384?m=-6176:m-=l;m>6111;){if((c+=1)-g>34){let t=u.join("");if(t.match(/^0+$/)){m=6111;break}d(e,"overflow")}m-=1}for(;m<-6176||a<s;){if(0===c&&i<a){m=-6176,i=0;break}if(a<s?s-=1:c-=1,m<6111)m+=1;else{let t=u.join("");if(t.match(/^0+$/)){m=6111;break}d(e,"overflow")}}if(c-g+1<i){let r=o;n&&(f+=1,r+=1),t&&(f+=1,r+=1);let i=parseInt(e[f+c+1],10),s=0;if(i>=5&&(s=1,5===i)){for(s=u[c]%2==1?1:0,p=f+c+2;p<r;p++)if(parseInt(e[p],10)){s=1;break}}if(s){let e=c;for(;e>=0;e--)if(++u[e]>9&&(u[e]=0,0===e)){if(!(m<6111))return new e$(t?eN:eO);m+=1,u[e]=1}}}if(y=ey.fromNumber(0),w=ey.fromNumber(0),0===i)y=ey.fromNumber(0),w=ey.fromNumber(0);else if(c-g<17){let e=g;for(w=ey.fromNumber(u[e++]),y=new ey(0,0);e<=c;e++)w=(w=w.multiply(ey.fromNumber(10))).add(ey.fromNumber(u[e]))}else{let e=g;for(y=ey.fromNumber(u[e++]);e<=c-17;e++)y=(y=y.multiply(ey.fromNumber(10))).add(ey.fromNumber(u[e]));for(w=ey.fromNumber(u[e++]);e<=c;e++)w=(w=w.multiply(ey.fromNumber(10))).add(ey.fromNumber(u[e]))}let _=function(e,t){if(!e&&!t)return{high:ey.fromNumber(0),low:ey.fromNumber(0)};let n=e.shiftRightUnsigned(32),r=new ey(e.getLowBits(),0),i=t.shiftRightUnsigned(32),o=new ey(t.getLowBits(),0),s=n.multiply(i),l=n.multiply(o),f=r.multiply(i),u=r.multiply(o);return s=s.add(l.shiftRightUnsigned(32)),l=new ey(l.getLowBits(),0).add(f).add(u.shiftRightUnsigned(32)),s=s.add(l.shiftRightUnsigned(32)),u=l.shiftLeft(32).add(new ey(u.getLowBits(),0)),{high:s,low:u}}(y,ey.fromString("100000000000000000"));_.low=_.low.add(w),function(e,t){let n=e.high>>>0,r=t.high>>>0;if(n<r)return!0;if(n===r){let n=e.low>>>0,r=t.low>>>0;if(n<r)return!0}return!1}(_.low,w)&&(_.high=_.high.add(ey.fromNumber(1))),x=m+6176;let $={low:ey.fromNumber(0),high:ey.fromNumber(0)};_.high.shiftRightUnsigned(49).and(ey.fromNumber(1)).equals(ey.fromNumber(1))?($.high=$.high.or(ey.fromNumber(3).shiftLeft(61)),$.high=$.high.or(ey.fromNumber(x).and(ey.fromNumber(16383).shiftLeft(47))),$.high=$.high.or(_.high.and(ey.fromNumber(0x7fffffffffff)))):($.high=$.high.or(ey.fromNumber(16383&x).shiftLeft(49)),$.high=$.high.or(_.high.and(ey.fromNumber(562949953421311)))),$.low=_.low,t&&($.high=$.high.or(ey.fromString("9223372036854775808")));let E=ei.allocate(16);return S=0,E[S++]=255&$.low.low,E[S++]=$.low.low>>8&255,E[S++]=$.low.low>>16&255,E[S++]=$.low.low>>24&255,E[S++]=255&$.low.high,E[S++]=$.low.high>>8&255,E[S++]=$.low.high>>16&255,E[S++]=$.low.high>>24&255,E[S++]=255&$.high.low,E[S++]=$.high.low>>8&255,E[S++]=$.high.low>>16&255,E[S++]=$.high.low>>24&255,E[S++]=255&$.high.high,E[S++]=$.high.high>>8&255,E[S++]=$.high.high>>16&255,E[S++]=$.high.high>>24&255,new e$(E)}toString(){let e,t,n,r;let i=0,o=Array(36);for(let e=0;e<o.length;e++)o[e]=0;let s=0,l=!1,f={parts:[0,0,0,0]},u=[];s=0;let a=this.bytes,h=a[s++]|a[s++]<<8|a[s++]<<16|a[s++]<<24,g=a[s++]|a[s++]<<8|a[s++]<<16|a[s++]<<24,c=a[s++]|a[s++]<<8|a[s++]<<16|a[s++]<<24,b=a[s++]|a[s++]<<8|a[s++]<<16|a[s++]<<24;s=0;let d={low:new ey(h,g),high:new ey(c,b)};d.high.lessThan(ey.ZERO)&&u.push("-");let m=b>>26&31;if(m>>3==3){if(30===m)return u.join("")+"Infinity";if(31===m)return"NaN";e=b>>15&16383,t=8+(b>>14&1)}else t=b>>14&7,e=b>>17&16383;let p=e-6176;if(f.parts[0]=(16383&b)+((15&t)<<14),f.parts[1]=c,f.parts[2]=g,f.parts[3]=h,0===f.parts[0]&&0===f.parts[1]&&0===f.parts[2]&&0===f.parts[3])l=!0;else for(r=3;r>=0;r--){let e=0,t=function(e){let t=ey.fromNumber(1e9),n=ey.fromNumber(0);if(!e.parts[0]&&!e.parts[1]&&!e.parts[2]&&!e.parts[3])return{quotient:e,rem:n};for(let r=0;r<=3;r++)n=(n=n.shiftLeft(32)).add(new ey(e.parts[r],0)),e.parts[r]=n.div(t).low,n=n.modulo(t);return{quotient:e,rem:n}}(f);if(f=t.quotient,e=t.rem.low)for(n=8;n>=0;n--)o[9*r+n]=e%10,e=Math.floor(e/10)}if(l)i=1,o[s]=0;else for(i=36;!o[s];)i-=1,s+=1;let y=i-1+p;if(y>=34||y<=-7||p>0){if(i>34)return u.push("0"),p>0?u.push(`E+${p}`):p<0&&u.push(`E${p}`),u.join("");u.push(`${o[s++]}`),(i-=1)&&u.push(".");for(let e=0;e<i;e++)u.push(`${o[s++]}`);u.push("E"),y>0?u.push(`+${y}`):u.push(`${y}`)}else if(p>=0)for(let e=0;e<i;e++)u.push(`${o[s++]}`);else{let e=i+p;if(e>0)for(let t=0;t<e;t++)u.push(`${o[s++]}`);else u.push("0");for(u.push(".");e++<0;)u.push("0");for(let t=0;t<i-Math.max(e-1,0);t++)u.push(`${o[s++]}`)}return u.join("")}toJSON(){return{$numberDecimal:this.toString()}}toExtendedJSON(){return{$numberDecimal:this.toString()}}static fromExtendedJSON(e){return e$.fromString(e.$numberDecimal)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new Decimal128("${this.toString()}")`}}class eE extends eu{get _bsontype(){return"Double"}constructor(e){super(),e instanceof Number&&(e=e.valueOf()),this.value=+e}valueOf(){return this.value}toJSON(){return this.value}toString(e){return this.value.toString(e)}toExtendedJSON(e){return e&&(e.legacy||e.relaxed&&isFinite(this.value))?this.value:Object.is(Math.sign(this.value),-0)?{$numberDouble:"-0.0"}:{$numberDouble:Number.isInteger(this.value)?this.value.toFixed(1):this.value.toString()}}static fromExtendedJSON(e,t){let n=parseFloat(e.$numberDouble);return t&&t.relaxed?n:new eE(n)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){let e=this.toExtendedJSON();return`new Double(${e.$numberDouble})`}}class eU extends eu{get _bsontype(){return"Int32"}constructor(e){super(),e instanceof Number&&(e=e.valueOf()),this.value=0|+e}valueOf(){return this.value}toString(e){return this.value.toString(e)}toJSON(){return this.value}toExtendedJSON(e){return e&&(e.relaxed||e.legacy)?this.value:{$numberInt:this.value.toString()}}static fromExtendedJSON(e,t){return t&&t.relaxed?parseInt(e.$numberInt,10):new eU(e.$numberInt)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new Int32(${this.valueOf()})`}}class eL extends eu{get _bsontype(){return"MaxKey"}toExtendedJSON(){return{$maxKey:1}}static fromExtendedJSON(){return new eL}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return"new MaxKey()"}}class eI extends eu{get _bsontype(){return"MinKey"}toExtendedJSON(){return{$minKey:1}}static fromExtendedJSON(){return new eI}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return"new MinKey()"}}let eT=RegExp("^[0-9a-fA-F]{24}$"),ev=null,ej=Symbol("id");class eA extends eu{get _bsontype(){return"ObjectId"}constructor(e){let t;if(super(),"object"==typeof e&&e&&"id"in e){if("string"!=typeof e.id&&!ArrayBuffer.isView(e.id))throw new K("Argument passed in must have an id that is of type string or Buffer");t="toHexString"in e&&"function"==typeof e.toHexString?ei.fromHex(e.toHexString()):e.id}else t=e;if(null==t||"number"==typeof t)this[ej]=eA.generate("number"==typeof t?t:void 0);else if(ArrayBuffer.isView(t)&&12===t.byteLength)this[ej]=ei.toLocalBufferType(t);else if("string"==typeof t){if(12===t.length){let e=ei.fromUTF8(t);if(12===e.byteLength)this[ej]=e;else throw new K("Argument passed in must be a string of 12 bytes")}else if(24===t.length&&eT.test(t))this[ej]=ei.fromHex(t);else throw new K("Argument passed in must be a string of 12 bytes or a string of 24 hex characters or an integer")}else throw new K("Argument passed in does not match the accepted types");eA.cacheHexString&&(this.__id=ei.toHex(this.id))}get id(){return this[ej]}set id(e){this[ej]=e,eA.cacheHexString&&(this.__id=ei.toHex(e))}toHexString(){if(eA.cacheHexString&&this.__id)return this.__id;let e=ei.toHex(this.id);return eA.cacheHexString&&!this.__id&&(this.__id=e),e}static getInc(){return eA.index=(eA.index+1)%16777215}static generate(e){"number"!=typeof e&&(e=Math.floor(Date.now()/1e3));let t=eA.getInc(),n=ei.allocate(12);return eo.fromUint8Array(n).setUint32(0,e,!1),null===ev&&(ev=ei.randomBytes(5)),n[4]=ev[0],n[5]=ev[1],n[6]=ev[2],n[7]=ev[3],n[8]=ev[4],n[11]=255&t,n[10]=t>>8&255,n[9]=t>>16&255,n}toString(e){return"base64"===e?ei.toBase64(this.id):this.toHexString()}toJSON(){return this.toHexString()}equals(e){if(null==e)return!1;if(e instanceof eA)return this[ej][11]===e[ej][11]&&ei.equals(this[ej],e[ej]);if("string"==typeof e&&eA.isValid(e)&&12===e.length&&u(this.id))return ei.equals(this.id,ei.fromISO88591(e));if("string"==typeof e&&eA.isValid(e)&&24===e.length)return e.toLowerCase()===this.toHexString();if("string"==typeof e&&eA.isValid(e)&&12===e.length)return ei.equals(ei.fromUTF8(e),this.id);if("object"==typeof e&&"toHexString"in e&&"function"==typeof e.toHexString){let t=e.toHexString(),n=this.toHexString().toLowerCase();return"string"==typeof t&&t.toLowerCase()===n}return!1}getTimestamp(){let e=new Date,t=eo.fromUint8Array(this.id).getUint32(0,!1);return e.setTime(1e3*Math.floor(t)),e}static createPk(){return new eA}static createFromTime(e){let t=ei.fromNumberArray([0,0,0,0,0,0,0,0,0,0,0,0]);return eo.fromUint8Array(t).setUint32(0,e,!1),new eA(t)}static createFromHexString(e){if(e?.length!==24)throw new K("hex string must be 24 characters");return new eA(ei.fromHex(e))}static createFromBase64(e){if(e?.length!==16)throw new K("base64 string must be 16 characters");return new eA(ei.fromBase64(e))}static isValid(e){if(null==e)return!1;try{return new eA(e),!0}catch{return!1}}toExtendedJSON(){return this.toHexString?{$oid:this.toHexString()}:{$oid:this.toString("hex")}}static fromExtendedJSON(e){return new eA(e.$oid)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new ObjectId("${this.toHexString()}")`}}function m(e,t,n){let r=5;if(Array.isArray(e))for(let i=0;i<e.length;i++)r+=p(i.toString(),e[i],t,!0,n);else for(let i of("function"==typeof e?.toBSON&&(e=e.toBSON()),Object.keys(e)))r+=p(i,e[i],t,!1,n);return r}function p(e,t,n=!1,r=!1,i=!1){switch("function"==typeof t?.toBSON&&(t=t.toBSON()),typeof t){case"string":return 1+ei.utf8ByteLength(e)+1+4+ei.utf8ByteLength(t)+1;case"number":if(Math.floor(t)!==t||!(t>=-9007199254740992)||!(t<=9007199254740992))return(null!=e?ei.utf8ByteLength(e)+1:0)+9;if(t>=-2147483648&&t<=2147483647)return(null!=e?ei.utf8ByteLength(e)+1:0)+5;return(null!=e?ei.utf8ByteLength(e)+1:0)+9;case"undefined":if(r||!i)return(null!=e?ei.utf8ByteLength(e)+1:0)+1;break;case"boolean":return(null!=e?ei.utf8ByteLength(e)+1:0)+2;case"object":if(null!=t&&"string"==typeof t._bsontype&&5!==t[Symbol.for("@@mdb.bson.version")])throw new W;if(null==t||"MinKey"===t._bsontype||"MaxKey"===t._bsontype)return(null!=e?ei.utf8ByteLength(e)+1:0)+1;if("ObjectId"===t._bsontype)return(null!=e?ei.utf8ByteLength(e)+1:0)+13;if(t instanceof Date||g(t))return(null!=e?ei.utf8ByteLength(e)+1:0)+9;else if(ArrayBuffer.isView(t)||t instanceof ArrayBuffer||f(t))return(null!=e?ei.utf8ByteLength(e)+1:0)+6+t.byteLength;else if("Long"===t._bsontype||"Double"===t._bsontype||"Timestamp"===t._bsontype)return(null!=e?ei.utf8ByteLength(e)+1:0)+9;else if("Decimal128"===t._bsontype)return(null!=e?ei.utf8ByteLength(e)+1:0)+17;else if("Code"===t._bsontype){if(null!=t.scope&&Object.keys(t.scope).length>0)return(null!=e?ei.utf8ByteLength(e)+1:0)+1+4+4+ei.utf8ByteLength(t.code.toString())+1+m(t.scope,n,i);return(null!=e?ei.utf8ByteLength(e)+1:0)+1+4+ei.utf8ByteLength(t.code.toString())+1}else if("Binary"===t._bsontype){let n=t;if(n.sub_type===ea.SUBTYPE_BYTE_ARRAY)return(null!=e?ei.utf8ByteLength(e)+1:0)+(n.position+1+4+1+4);return(null!=e?ei.utf8ByteLength(e)+1:0)+(n.position+1+4+1)}else if("Symbol"===t._bsontype)return(null!=e?ei.utf8ByteLength(e)+1:0)+ei.utf8ByteLength(t.value)+4+1+1;else if("DBRef"===t._bsontype){let r=Object.assign({$ref:t.collection,$id:t.oid},t.fields);return null!=t.db&&(r.$db=t.db),(null!=e?ei.utf8ByteLength(e)+1:0)+1+m(r,n,i)}else if(t instanceof RegExp||a(t))return(null!=e?ei.utf8ByteLength(e)+1:0)+1+ei.utf8ByteLength(t.source)+1+(t.global?1:0)+(t.ignoreCase?1:0)+(t.multiline?1:0)+1;else if("BSONRegExp"===t._bsontype)return(null!=e?ei.utf8ByteLength(e)+1:0)+1+ei.utf8ByteLength(t.pattern)+1+ei.utf8ByteLength(t.options)+1;else return(null!=e?ei.utf8ByteLength(e)+1:0)+m(t,n,i)+1;case"function":if(n)return(null!=e?ei.utf8ByteLength(e)+1:0)+1+4+ei.utf8ByteLength(t.toString())+1}return 0}eA.index=Math.floor(16777215*Math.random());class eR extends eu{get _bsontype(){return"BSONRegExp"}constructor(e,t){if(super(),this.pattern=e,this.options=(t??"").split("").sort().join(""),-1!==this.pattern.indexOf("\x00"))throw new K(`BSON Regex patterns cannot contain null bytes, found: ${JSON.stringify(this.pattern)}`);if(-1!==this.options.indexOf("\x00"))throw new K(`BSON Regex options cannot contain null bytes, found: ${JSON.stringify(this.options)}`);for(let e=0;e<this.options.length;e++)if(!("i"===this.options[e]||"m"===this.options[e]||"x"===this.options[e]||"l"===this.options[e]||"s"===this.options[e]||"u"===this.options[e]))throw new K(`The regular expression option [${this.options[e]}] is not supported`)}static parseOptions(e){return e?e.split("").sort().join(""):""}toExtendedJSON(e){return(e=e||{}).legacy?{$regex:this.pattern,$options:this.options}:{$regularExpression:{pattern:this.pattern,options:this.options}}}static fromExtendedJSON(e){if("$regex"in e){if("string"==typeof e.$regex)return new eR(e.$regex,eR.parseOptions(e.$options));if("BSONRegExp"===e.$regex._bsontype)return e}if("$regularExpression"in e)return new eR(e.$regularExpression.pattern,eR.parseOptions(e.$regularExpression.options));throw new K(`Unexpected BSONRegExp EJSON object form: ${JSON.stringify(e)}`)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new BSONRegExp(${JSON.stringify(this.pattern)}, ${JSON.stringify(this.options)})`}}class eD extends eu{get _bsontype(){return"BSONSymbol"}constructor(e){super(),this.value=e}valueOf(){return this.value}toString(){return this.value}inspect(){return`new BSONSymbol("${this.value}")`}toJSON(){return this.value}toExtendedJSON(){return{$symbol:this.value}}static fromExtendedJSON(e){return new eD(e.$symbol)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}}let eF=ey;class eM extends eF{get _bsontype(){return"Timestamp"}constructor(e){if(null==e)super(0,0,!0);else if("bigint"==typeof e)super(e,!0);else if(ey.isLong(e))super(e.low,e.high,!0);else if("object"==typeof e&&"t"in e&&"i"in e){if("number"!=typeof e.t&&("object"!=typeof e.t||"Int32"!==e.t._bsontype))throw new K("Timestamp constructed from { t, i } must provide t as a number");if("number"!=typeof e.i&&("object"!=typeof e.i||"Int32"!==e.i._bsontype))throw new K("Timestamp constructed from { t, i } must provide i as a number");if(e.t<0)throw new K("Timestamp constructed from { t, i } must provide a positive t");if(e.i<0)throw new K("Timestamp constructed from { t, i } must provide a positive i");if(e.t>4294967295)throw new K("Timestamp constructed from { t, i } must provide t equal or less than uint32 max");if(e.i>4294967295)throw new K("Timestamp constructed from { t, i } must provide i equal or less than uint32 max");super(e.i.valueOf(),e.t.valueOf(),!0)}else throw new K("A Timestamp can only be constructed with: bigint, Long, or { t: number; i: number }")}toJSON(){return{$timestamp:this.toString()}}static fromInt(e){return new eM(ey.fromInt(e,!0))}static fromNumber(e){return new eM(ey.fromNumber(e,!0))}static fromBits(e,t){return new eM({i:e,t:t})}static fromString(e,t){return new eM(ey.fromString(e,!0,t))}toExtendedJSON(){return{$timestamp:{t:this.high>>>0,i:this.low>>>0}}}static fromExtendedJSON(e){let t=ey.isLong(e.$timestamp.i)?e.$timestamp.i.getLowBitsUnsigned():e.$timestamp.i,n=ey.isLong(e.$timestamp.t)?e.$timestamp.t.getLowBitsUnsigned():e.$timestamp.t;return new eM({t:n,i:t})}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new Timestamp({ t: ${this.getHighBits()}, i: ${this.getLowBits()} })`}}function y(e,t,n){let r=0;for(let i=t;i<n;i+=1){let t=e[i];if(r){if((192&t)!=128)return!1;r-=1}else if(128&t){if((224&t)==192)r=1;else if((240&t)==224)r=2;else{if((248&t)!=240)return!1;r=3}}}return!r}eM.MAX_VALUE=ey.MAX_UNSIGNED_VALUE;let eJ=ey.fromNumber(9007199254740992),eV=ey.fromNumber(-9007199254740992);function w(e,t,n){t=null==t?{}:t;let r=t&&t.index?t.index:0,i=e[r]|e[r+1]<<8|e[r+2]<<16|e[r+3]<<24;if(i<5)throw new K(`bson size must be >= 5, is ${i}`);if(t.allowObjectSmallerThanBufferSize&&e.length<i)throw new K(`buffer length ${e.length} must be >= bson size ${i}`);if(!t.allowObjectSmallerThanBufferSize&&e.length!==i)throw new K(`buffer length ${e.length} must === bson size ${i}`);if(i+r>e.byteLength)throw new K(`(bson size ${i} + options.index ${r} must be <= buffer length ${e.byteLength})`);if(0!==e[r+i-1])throw new K("One object, sized correctly, with a spot for an EOO, but the EOO isn't 0x00");return function e(t,n,r,i=!1){let o;let s=null==r.fieldsAsRaw?null:r.fieldsAsRaw,l=null!=r.raw&&r.raw,f="boolean"==typeof r.bsonRegExp&&r.bsonRegExp,u=r.promoteBuffers??!1,a=r.promoteLongs??!0,h=r.promoteValues??!0,g=r.useBigInt64??!1;if(g&&!h||g&&!a)throw new K("Must either request bigint or Long for int64 deserialization");let b=null==r.validation?{utf8:!0}:r.validation,d=!0,m=new Set,p=b.utf8;if("boolean"==typeof p)o=p;else{d=!1;let e=Object.keys(p).map(function(e){return p[e]});if(0===e.length)throw new K("UTF-8 validation setting cannot be empty");if("boolean"!=typeof e[0])throw new K("Invalid UTF-8 validation option, must specify boolean values");if(o=e[0],!e.every(e=>e===o))throw new K("Invalid UTF-8 validation option - keys must be all true or all false")}if(!d)for(let e of Object.keys(p))m.add(e);let w=n;if(t.length<5)throw new K("corrupt bson message < 5 bytes long");let S=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;if(S<5||S>t.length)throw new K("corrupt bson message");let B=i?[]:{},N=0,O=!i&&null,_=new DataView(t.buffer,t.byteOffset,t.byteLength);for(;;){let c;let p=t[n++];if(0===p)break;let w=n;for(;0!==t[w]&&w<t.length;)w++;if(w>=t.byteLength)throw new K("Bad BSON Document: illegal CString");let S=i?N++:ei.toUTF8(t.subarray(n,w)),$=!0;if($=d||m.has(S)?o:!o,!1!==O&&"$"===S[0]&&(O=ez.test(S)),n=w+1,2===p){let e=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;if(e<=0||e>t.length-n||0!==t[n+e-1])throw new K("bad string length in bson");c=x(t,n,n+e-1,$),n+=e}else if(7===p){let e=ei.allocate(12);e.set(t.subarray(n,n+12)),c=new eA(e),n+=12}else if(16===p&&!1===h)c=new eU(t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24);else if(16===p)c=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;else if(1===p&&!1===h)c=new eE(_.getFloat64(n,!0)),n+=8;else if(1===p)c=_.getFloat64(n,!0),n+=8;else if(9===p){let e=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24,r=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;c=new Date(new ey(e,r).toNumber())}else if(8===p){if(0!==t[n]&&1!==t[n])throw new K("illegal boolean type value");c=1===t[n++]}else if(3===p){let i=n,o=t[n]|t[n+1]<<8|t[n+2]<<16|t[n+3]<<24;if(o<=0||o>t.length-n)throw new K("bad embedded document length in bson");if(l)c=t.slice(n,n+o);else{let n=r;d||(n={...r,validation:{utf8:$}}),c=e(t,i,n,!1)}n+=o}else if(4===p){let i=n,o=t[n]|t[n+1]<<8|t[n+2]<<16|t[n+3]<<24,l=r,f=n+o;if(s&&s[S]&&(l={...r,raw:!0}),d||(l={...l,validation:{utf8:$}}),c=e(t,i,l,!0),n+=o,0!==t[n-1])throw new K("invalid array terminator byte");if(n!==f)throw new K("corrupted array bson")}else if(6===p)c=void 0;else if(10===p)c=null;else if(18===p){let e=eo.fromUint8Array(t.subarray(n,n+8)),r=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24,i=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24,o=new ey(r,i);c=g?e.getBigInt64(0,!0):a&&!0===h&&o.lessThanOrEqual(eJ)&&o.greaterThanOrEqual(eV)?o.toNumber():o}else if(19===p){let e=ei.allocate(16);e.set(t.subarray(n,n+16),0),n+=16,c=new e$(e)}else if(5===p){let e=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24,r=e,i=t[n++];if(e<0)throw new K("Negative binary type element size found");if(e>t.byteLength)throw new K("Binary type size larger than document size");if(null!=t.slice){if(i===ea.SUBTYPE_BYTE_ARRAY){if((e=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24)<0)throw new K("Negative binary type element size found for subtype 0x02");if(e>r-4)throw new K("Binary type with subtype 0x02 contains too long binary size");if(e<r-4)throw new K("Binary type with subtype 0x02 contains too short binary size")}u&&h?c=ei.toLocalBufferType(t.slice(n,n+e)):(c=new ea(t.slice(n,n+e),i),4===i&&(c=c.toUUID()))}else{let o=ei.allocate(e);if(i===ea.SUBTYPE_BYTE_ARRAY){if((e=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24)<0)throw new K("Negative binary type element size found for subtype 0x02");if(e>r-4)throw new K("Binary type with subtype 0x02 contains too long binary size");if(e<r-4)throw new K("Binary type with subtype 0x02 contains too short binary size")}for(w=0;w<e;w++)o[w]=t[n+w];c=u&&h?o:4===i?new ea(t.slice(n,n+e),i).toUUID():new ea(t.slice(n,n+e),i)}n+=e}else if(11===p&&!1===f){for(w=n;0!==t[w]&&w<t.length;)w++;if(w>=t.length)throw new K("Bad BSON Document: illegal CString");let e=ei.toUTF8(t.subarray(n,w));for(w=n=w+1;0!==t[w]&&w<t.length;)w++;if(w>=t.length)throw new K("Bad BSON Document: illegal CString");let r=ei.toUTF8(t.subarray(n,w));n=w+1;let i=Array(r.length);for(w=0;w<r.length;w++)switch(r[w]){case"m":i[w]="m";break;case"s":i[w]="g";break;case"i":i[w]="i"}c=new RegExp(e,i.join(""))}else if(11===p&&!0===f){for(w=n;0!==t[w]&&w<t.length;)w++;if(w>=t.length)throw new K("Bad BSON Document: illegal CString");let e=ei.toUTF8(t.subarray(n,w));for(w=n=w+1;0!==t[w]&&w<t.length;)w++;if(w>=t.length)throw new K("Bad BSON Document: illegal CString");let r=ei.toUTF8(t.subarray(n,w));n=w+1,c=new eR(e,r)}else if(14===p){let e=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;if(e<=0||e>t.length-n||0!==t[n+e-1])throw new K("bad string length in bson");let r=x(t,n,n+e-1,$);c=h?r:new eD(r),n+=e}else if(17===p){let e=t[n++]+256*t[n++]+65536*t[n++]+16777216*t[n++],r=t[n++]+256*t[n++]+65536*t[n++]+16777216*t[n++];c=new eM({i:e,t:r})}else if(255===p)c=new eI;else if(127===p)c=new eL;else if(13===p){let e=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;if(e<=0||e>t.length-n||0!==t[n+e-1])throw new K("bad string length in bson");let r=x(t,n,n+e-1,$);c=new eg(r),n+=e}else if(15===p){let i=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;if(i<13)throw new K("code_w_scope total size shorter minimum expected length");let o=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;if(o<=0||o>t.length-n||0!==t[n+o-1])throw new K("bad string length in bson");let s=x(t,n,n+o-1,$);n+=o;let l=n,f=t[n]|t[n+1]<<8|t[n+2]<<16|t[n+3]<<24,u=e(t,l,r,!1);if(n+=f,i<8+f+o)throw new K("code_w_scope total size is too short, truncating scope");if(i>8+f+o)throw new K("code_w_scope total size is too long, clips outer document");c=new eg(s,u)}else if(12===p){let e=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;if(e<=0||e>t.length-n||0!==t[n+e-1])throw new K("bad string length in bson");if(null!=b&&b.utf8&&!y(t,n,n+e-1))throw new K("Invalid UTF-8 string in BSON document");let r=ei.toUTF8(t.subarray(n,n+e-1));n+=e;let i=ei.allocate(12);i.set(t.subarray(n,n+12),0);let o=new eA(i);n+=12,c=new ec(r,o)}else throw new K(`Detected unknown BSON type ${p.toString(16)} for fieldname "${S}"`);"__proto__"===S?Object.defineProperty(B,S,{value:c,writable:!0,enumerable:!0,configurable:!0}):B[S]=c}if(S!==n-w){if(i)throw new K("corrupt array bson");throw new K("corrupt object bson")}if(!O)return B;if(c(B)){let e=Object.assign({},B);return delete e.$ref,delete e.$id,delete e.$db,new ec(B.$ref,B.$id,B.$db,e)}return B}(e,r,t,n)}let ez=/^\$ref$|^\$id$|^\$db$/;function x(e,t,n,r){let i=ei.toUTF8(e.subarray(t,n));if(r){for(let r=0;r<i.length;r++)if(65533===i.charCodeAt(r)){if(!y(e,t,n))throw new K("Invalid UTF-8 string in BSON document");break}}return i}let eH=/\x00/,eq=new Set(["$db","$ref","$id","$clusterTime"]);function S(e,t,n,r){e[r++]=2;let i=ei.encodeUTF8Into(e,t,r);e[(r=r+i+1)-1]=0;let o=ei.encodeUTF8Into(e,n,r+4);return e[r+3]=o+1>>24&255,e[r+2]=o+1>>16&255,e[r+1]=o+1>>8&255,e[r]=o+1&255,r=r+4+o,e[r++]=0,r}let ek=new DataView(new ArrayBuffer(8),0,8),eC=new Uint8Array(ek.buffer,0,4),eY=new Uint8Array(ek.buffer,0,8);function B(e,t,n,r){let i=Object.is(n,-0),o=!i&&Number.isSafeInteger(n)&&n<=2147483647&&n>=-2147483648?16:1;16===o?ek.setInt32(0,n,!0):ek.setFloat64(0,n,!0);let s=16===o?eC:eY;e[r++]=o;let l=ei.encodeUTF8Into(e,t,r);return r+=l,e[r++]=0,e.set(s,r),r+=s.byteLength}function N(e,t,n,r){e[r++]=18;let i=ei.encodeUTF8Into(e,t,r);return r+=i,e[r++]=0,ek.setBigInt64(0,n,!0),e.set(eY,r),r+=eY.byteLength}function O(e,t,n,r){e[r++]=10;let i=ei.encodeUTF8Into(e,t,r);return r+=i,e[r++]=0,r}function _(e,t,n,r){e[r++]=8;let i=ei.encodeUTF8Into(e,t,r);return r+=i,e[r++]=0,e[r++]=n?1:0,r}function $(e,t,n,r){e[r++]=9;let i=ei.encodeUTF8Into(e,t,r);r+=i,e[r++]=0;let o=ey.fromNumber(n.getTime()),s=o.getLowBits(),l=o.getHighBits();return e[r++]=255&s,e[r++]=s>>8&255,e[r++]=s>>16&255,e[r++]=s>>24&255,e[r++]=255&l,e[r++]=l>>8&255,e[r++]=l>>16&255,e[r++]=l>>24&255,r}function E(e,t,n,r){e[r++]=11;let i=ei.encodeUTF8Into(e,t,r);if(r+=i,e[r++]=0,n.source&&null!=n.source.match(eH))throw new K("value "+n.source+" must not contain null bytes");return r+=ei.encodeUTF8Into(e,n.source,r),e[r++]=0,n.ignoreCase&&(e[r++]=105),n.global&&(e[r++]=115),n.multiline&&(e[r++]=109),e[r++]=0,r}function U(e,t,n,r){e[r++]=11;let i=ei.encodeUTF8Into(e,t,r);if(r+=i,e[r++]=0,null!=n.pattern.match(eH))throw new K("pattern "+n.pattern+" must not contain null bytes");r+=ei.encodeUTF8Into(e,n.pattern,r),e[r++]=0;let o=n.options.split("").sort().join("");return r+=ei.encodeUTF8Into(e,o,r),e[r++]=0,r}function L(e,t,n,r){null===n?e[r++]=10:"MinKey"===n._bsontype?e[r++]=255:e[r++]=127;let i=ei.encodeUTF8Into(e,t,r);return r+=i,e[r++]=0,r}function I(e,t,n,r){e[r++]=7;let i=ei.encodeUTF8Into(e,t,r);if(r+=i,e[r++]=0,u(n.id))e.set(n.id.subarray(0,12),r);else throw new K("object ["+JSON.stringify(n)+"] is not a valid ObjectId");return r+12}function T(e,t,n,r){e[r++]=5;let i=ei.encodeUTF8Into(e,t,r);r+=i,e[r++]=0;let o=n.length;return e[r++]=255&o,e[r++]=o>>8&255,e[r++]=o>>16&255,e[r++]=o>>24&255,e[r++]=0,e.set(n,r),r+=o}function v(e,t,n,r,i,o,s,l,f){if(f.has(n))throw new K("Cannot convert circular structure to BSON");f.add(n),e[r++]=Array.isArray(n)?4:3;let u=ei.encodeUTF8Into(e,t,r);r+=u,e[r++]=0;let a=H(e,n,i,r,o+1,s,l,f);return f.delete(n),a}function j(e,t,n,r){e[r++]=19;let i=ei.encodeUTF8Into(e,t,r);return r+=i,e[r++]=0,e.set(n.bytes.subarray(0,16),r),r+16}function A(e,t,n,r){e[r++]="Long"===n._bsontype?18:17;let i=ei.encodeUTF8Into(e,t,r);r+=i,e[r++]=0;let o=n.getLowBits(),s=n.getHighBits();return e[r++]=255&o,e[r++]=o>>8&255,e[r++]=o>>16&255,e[r++]=o>>24&255,e[r++]=255&s,e[r++]=s>>8&255,e[r++]=s>>16&255,e[r++]=s>>24&255,r}function R(e,t,n,r){n=n.valueOf(),e[r++]=16;let i=ei.encodeUTF8Into(e,t,r);return r+=i,e[r++]=0,e[r++]=255&n,e[r++]=n>>8&255,e[r++]=n>>16&255,e[r++]=n>>24&255,r}function D(e,t,n,r){e[r++]=1;let i=ei.encodeUTF8Into(e,t,r);return r+=i,e[r++]=0,ek.setFloat64(0,n.value,!0),e.set(eY,r),r+=8}function F(e,t,n,r){e[r++]=13;let i=ei.encodeUTF8Into(e,t,r);r+=i,e[r++]=0;let o=n.toString(),s=ei.encodeUTF8Into(e,o,r+4)+1;return e[r]=255&s,e[r+1]=s>>8&255,e[r+2]=s>>16&255,e[r+3]=s>>24&255,r=r+4+s-1,e[r++]=0,r}function M(e,t,n,r,i=!1,o=0,s=!1,l=!0,f){if(n.scope&&"object"==typeof n.scope){e[r++]=15;let u=ei.encodeUTF8Into(e,t,r);r+=u,e[r++]=0;let a=r,h=n.code;r+=4;let g=ei.encodeUTF8Into(e,h,r+4)+1;e[r]=255&g,e[r+1]=g>>8&255,e[r+2]=g>>16&255,e[r+3]=g>>24&255,e[r+4+g-1]=0,r=r+g+4;let c=H(e,n.scope,i,r,o+1,s,l,f);r=c-1;let b=c-a;e[a++]=255&b,e[a++]=b>>8&255,e[a++]=b>>16&255,e[a++]=b>>24&255,e[r++]=0}else{e[r++]=13;let i=ei.encodeUTF8Into(e,t,r);r+=i,e[r++]=0;let o=n.code.toString(),s=ei.encodeUTF8Into(e,o,r+4)+1;e[r]=255&s,e[r+1]=s>>8&255,e[r+2]=s>>16&255,e[r+3]=s>>24&255,r=r+4+s-1,e[r++]=0}return r}function J(e,t,n,r){e[r++]=5;let i=ei.encodeUTF8Into(e,t,r);r+=i,e[r++]=0;let o=n.buffer,s=n.position;return n.sub_type===ea.SUBTYPE_BYTE_ARRAY&&(s+=4),e[r++]=255&s,e[r++]=s>>8&255,e[r++]=s>>16&255,e[r++]=s>>24&255,e[r++]=n.sub_type,n.sub_type===ea.SUBTYPE_BYTE_ARRAY&&(s-=4,e[r++]=255&s,e[r++]=s>>8&255,e[r++]=s>>16&255,e[r++]=s>>24&255),e.set(o,r),r+=n.position}function V(e,t,n,r){e[r++]=14;let i=ei.encodeUTF8Into(e,t,r);r+=i,e[r++]=0;let o=ei.encodeUTF8Into(e,n.value,r+4)+1;return e[r]=255&o,e[r+1]=o>>8&255,e[r+2]=o>>16&255,e[r+3]=o>>24&255,r=r+4+o-1,e[r++]=0,r}function z(e,t,n,r,i,o,s){e[r++]=3;let l=ei.encodeUTF8Into(e,t,r);r+=l,e[r++]=0;let f=r,u={$ref:n.collection||n.namespace,$id:n.oid};null!=n.db&&(u.$db=n.db),u=Object.assign(u,n.fields);let a=H(e,u,!1,r,i+1,o,!0,s),h=a-f;return e[f++]=255&h,e[f++]=h>>8&255,e[f++]=h>>16&255,e[f++]=h>>24&255,a}function H(e,t,n,r,i,o,s,l){if(null==l){if(null==t)return e[0]=5,e[1]=0,e[2]=0,e[3]=0,e[4]=0,5;if(Array.isArray(t))throw new K("serialize does not support an array as the root input");if("object"!=typeof t)throw new K("serialize does not support non-object as the root input");if("_bsontype"in t&&"string"==typeof t._bsontype)throw new K("BSON types cannot be serialized as a document");if(g(t)||a(t)||u(t)||f(t))throw new K("date, regexp, typedarray, and arraybuffer cannot be BSON documents");l=new Set}l.add(t);let c=r+4;if(Array.isArray(t))for(let r=0;r<t.length;r++){let f=`${r}`,h=t[r];if("function"==typeof h?.toBSON&&(h=h.toBSON()),"string"==typeof h)c=S(e,f,h,c);else if("number"==typeof h)c=B(e,f,h,c);else if("bigint"==typeof h)c=N(e,f,h,c);else if("boolean"==typeof h)c=_(e,f,h,c);else if(h instanceof Date||g(h))c=$(e,f,h,c);else if(void 0===h)c=O(e,f,h,c);else if(null===h)c=O(e,f,h,c);else if(u(h))c=T(e,f,h,c);else if(h instanceof RegExp||a(h))c=E(e,f,h,c);else if("object"==typeof h&&null==h._bsontype)c=v(e,f,h,c,n,i,o,s,l);else if("object"==typeof h&&5!==h[Symbol.for("@@mdb.bson.version")])throw new W;else if("ObjectId"===h._bsontype)c=I(e,f,h,c);else if("Decimal128"===h._bsontype)c=j(e,f,h,c);else if("Long"===h._bsontype||"Timestamp"===h._bsontype)c=A(e,f,h,c);else if("Double"===h._bsontype)c=D(e,f,h,c);else if("function"==typeof h&&o)c=F(e,f,h,c);else if("Code"===h._bsontype)c=M(e,f,h,c,n,i,o,s,l);else if("Binary"===h._bsontype)c=J(e,f,h,c);else if("BSONSymbol"===h._bsontype)c=V(e,f,h,c);else if("DBRef"===h._bsontype)c=z(e,f,h,c,i,o,l);else if("BSONRegExp"===h._bsontype)c=U(e,f,h,c);else if("Int32"===h._bsontype)c=R(e,f,h,c);else if("MinKey"===h._bsontype||"MaxKey"===h._bsontype)c=L(e,f,h,c);else if(void 0!==h._bsontype)throw new K(`Unrecognized or invalid _bsontype: ${String(h._bsontype)}`)}else if(t instanceof Map||h(t)){let r=t.entries(),f=!1;for(;!f;){let t=r.next();if(f=!!t.done)continue;let h=t.value[0],b=t.value[1];"function"==typeof b?.toBSON&&(b=b.toBSON());let d=typeof b;if("string"==typeof h&&!eq.has(h)){if(null!=h.match(eH))throw new K("key "+h+" must not contain null bytes");if(n){if("$"===h[0])throw new K("key "+h+" must not start with '$'");if(~h.indexOf("."))throw new K("key "+h+" must not contain '.'")}}if("string"===d)c=S(e,h,b,c);else if("number"===d)c=B(e,h,b,c);else if("bigint"===d)c=N(e,h,b,c);else if("boolean"===d)c=_(e,h,b,c);else if(b instanceof Date||g(b))c=$(e,h,b,c);else if(null===b||void 0===b&&!1===s)c=O(e,h,b,c);else if(u(b))c=T(e,h,b,c);else if(b instanceof RegExp||a(b))c=E(e,h,b,c);else if("object"===d&&null==b._bsontype)c=v(e,h,b,c,n,i,o,s,l);else if("object"==typeof b&&5!==b[Symbol.for("@@mdb.bson.version")])throw new W;else if("ObjectId"===b._bsontype)c=I(e,h,b,c);else if("object"===d&&"Decimal128"===b._bsontype)c=j(e,h,b,c);else if("Long"===b._bsontype||"Timestamp"===b._bsontype)c=A(e,h,b,c);else if("Double"===b._bsontype)c=D(e,h,b,c);else if("Code"===b._bsontype)c=M(e,h,b,c,n,i,o,s,l);else if("function"==typeof b&&o)c=F(e,h,b,c);else if("Binary"===b._bsontype)c=J(e,h,b,c);else if("BSONSymbol"===b._bsontype)c=V(e,h,b,c);else if("DBRef"===b._bsontype)c=z(e,h,b,c,i,o,l);else if("BSONRegExp"===b._bsontype)c=U(e,h,b,c);else if("Int32"===b._bsontype)c=R(e,h,b,c);else if("MinKey"===b._bsontype||"MaxKey"===b._bsontype)c=L(e,h,b,c);else if(void 0!==b._bsontype)throw new K(`Unrecognized or invalid _bsontype: ${String(b._bsontype)}`)}}else{if("function"==typeof t?.toBSON&&(t=t.toBSON(),null!=t&&"object"!=typeof t))throw new K("toBSON function did not return an object");for(let r of Object.keys(t)){let f=t[r];"function"==typeof f?.toBSON&&(f=f.toBSON());let h=typeof f;if("string"==typeof r&&!eq.has(r)){if(null!=r.match(eH))throw new K("key "+r+" must not contain null bytes");if(n){if("$"===r[0])throw new K("key "+r+" must not start with '$'");if(~r.indexOf("."))throw new K("key "+r+" must not contain '.'")}}if("string"===h)c=S(e,r,f,c);else if("number"===h)c=B(e,r,f,c);else if("bigint"===h)c=N(e,r,f,c);else if("boolean"===h)c=_(e,r,f,c);else if(f instanceof Date||g(f))c=$(e,r,f,c);else if(void 0===f)!1===s&&(c=O(e,r,f,c));else if(null===f)c=O(e,r,f,c);else if(u(f))c=T(e,r,f,c);else if(f instanceof RegExp||a(f))c=E(e,r,f,c);else if("object"===h&&null==f._bsontype)c=v(e,r,f,c,n,i,o,s,l);else if("object"==typeof f&&5!==f[Symbol.for("@@mdb.bson.version")])throw new W;else if("ObjectId"===f._bsontype)c=I(e,r,f,c);else if("object"===h&&"Decimal128"===f._bsontype)c=j(e,r,f,c);else if("Long"===f._bsontype||"Timestamp"===f._bsontype)c=A(e,r,f,c);else if("Double"===f._bsontype)c=D(e,r,f,c);else if("Code"===f._bsontype)c=M(e,r,f,c,n,i,o,s,l);else if("function"==typeof f&&o)c=F(e,r,f,c);else if("Binary"===f._bsontype)c=J(e,r,f,c);else if("BSONSymbol"===f._bsontype)c=V(e,r,f,c);else if("DBRef"===f._bsontype)c=z(e,r,f,c,i,o,l);else if("BSONRegExp"===f._bsontype)c=U(e,r,f,c);else if("Int32"===f._bsontype)c=R(e,r,f,c);else if("MinKey"===f._bsontype||"MaxKey"===f._bsontype)c=L(e,r,f,c);else if(void 0!==f._bsontype)throw new K(`Unrecognized or invalid _bsontype: ${String(f._bsontype)}`)}}l.delete(t),e[c++]=0;let b=c-r;return e[r++]=255&b,e[r++]=b>>8&255,e[r++]=b>>16&255,e[r++]=b>>24&255,c}let eZ={$oid:eA,$binary:ea,$uuid:ea,$symbol:eD,$numberInt:eU,$numberDecimal:e$,$numberDouble:eE,$numberLong:ey,$minKey:eI,$maxKey:eL,$regex:eR,$regularExpression:eR,$timestamp:eM};function q(e){let t=e.toISOString();return 0!==e.getUTCMilliseconds()?t:t.slice(0,-5)+"Z"}let eP={Binary:e=>new ea(e.value(),e.sub_type),Code:e=>new eg(e.code,e.scope),DBRef:e=>new ec(e.collection||e.namespace,e.oid,e.db,e.fields),Decimal128:e=>new e$(e.bytes),Double:e=>new eE(e.value),Int32:e=>new eU(e.value),Long:e=>ey.fromBits(null!=e.low?e.low:e.low_,null!=e.low?e.high:e.high_,null!=e.low?e.unsigned:e.unsigned_),MaxKey:()=>new eL,MinKey:()=>new eI,ObjectId:e=>new eA(e),BSONRegExp:e=>new eR(e.pattern,e.options),BSONSymbol:e=>new eD(e.value),Timestamp:e=>eM.fromBits(e.low,e.high)};function k(e,t){let n={useBigInt64:t?.useBigInt64??!1,relaxed:t?.relaxed??!0,legacy:t?.legacy??!1};return JSON.parse(e,(e,t)=>{if(-1!==e.indexOf("\x00"))throw new K(`BSON Document field names cannot contain null bytes, found: ${JSON.stringify(e)}`);return function e(t,n={}){if("number"==typeof t){if(n.relaxed||n.legacy)return t;if(Number.isInteger(t)&&!Object.is(t,-0)){if(t<=2147483647&&t>=-2147483648)return new eU(t);if(t<=Z&&t>=-0x8000000000000000)return n.useBigInt64?BigInt(t):ey.fromNumber(t)}return new eE(t)}if(null==t||"object"!=typeof t)return t;if(t.$undefined)return null;let r=Object.keys(t).filter(e=>e.startsWith("$")&&null!=t[e]);for(let e=0;e<r.length;e++){let i=eZ[r[e]];if(i)return i.fromExtendedJSON(t,n)}if(null!=t.$date){let e=t.$date,r=new Date;if(n.legacy){if("number"==typeof e)r.setTime(e);else if("string"==typeof e)r.setTime(Date.parse(e));else if("bigint"==typeof e)r.setTime(Number(e));else throw new G(`Unrecognized type for EJSON date: ${typeof e}`)}else if("string"==typeof e)r.setTime(Date.parse(e));else if(ey.isLong(e))r.setTime(e.toNumber());else if("number"==typeof e&&n.relaxed)r.setTime(e);else if("bigint"==typeof e)r.setTime(Number(e));else throw new G(`Unrecognized type for EJSON date: ${typeof e}`);return r}if(null!=t.$code){let n=Object.assign({},t);return t.$scope&&(n.$scope=e(t.$scope)),eg.fromExtendedJSON(t)}if(c(t)||t.$dbPointer){let e=t.$ref?t:t.$dbPointer;if(e instanceof ec)return e;let n=Object.keys(e).filter(e=>e.startsWith("$")),r=!0;if(n.forEach(e=>{-1===["$ref","$id","$db"].indexOf(e)&&(r=!1)}),r)return ec.fromExtendedJSON(e)}return t}(t,n)})}function C(e,t,n,r){null!=n&&"object"==typeof n&&(r=n,n=0),null==t||"object"!=typeof t||Array.isArray(t)||(r=t,t=void 0,n=0);let i=Object.assign({relaxed:!0,legacy:!1},r,{seenObjects:[{propertyName:"(root)",obj:null}]}),o=function e(t,n){if(t instanceof Map||h(t)){let r=Object.create(null);for(let[e,n]of t){if("string"!=typeof e)throw new K("Can only serialize maps with string keys");r[e]=n}return e(r,n)}if(("object"==typeof t||"function"==typeof t)&&null!==t){let e=n.seenObjects.findIndex(e=>e.obj===t);if(-1!==e){let t=n.seenObjects.map(e=>e.propertyName),r=t.slice(0,e).map(e=>`${e} -> `).join(""),i=t[e],o=" -> "+t.slice(e+1,t.length-1).map(e=>`${e} -> `).join(""),s=t[t.length-1],l=" ".repeat(r.length+i.length/2),f="-".repeat(o.length+(i.length+s.length)/2-1);throw new K(`Converting circular structure to EJSON:
    ${r}${i}${o}${s}
    ${l}\\${f}/`)}n.seenObjects[n.seenObjects.length-1].obj=t}if(Array.isArray(t))return t.map((t,r)=>{n.seenObjects.push({propertyName:`index ${r}`,obj:null});try{return e(t,n)}finally{n.seenObjects.pop()}});if(void 0===t)return null;if(t instanceof Date||g(t)){let e=t.getTime(),r=e>-1&&e<2534023188e5;return n.legacy?n.relaxed&&r?{$date:t.getTime()}:{$date:q(t)}:n.relaxed&&r?{$date:q(t)}:{$date:{$numberLong:t.getTime().toString()}}}if("number"==typeof t&&(!n.relaxed||!isFinite(t))){if(Number.isInteger(t)&&!Object.is(t,-0)){if(t>=-2147483648&&t<=2147483647)return{$numberInt:t.toString()};if(t>=-0x8000000000000000&&t<=Z)return{$numberLong:t.toString()}}return{$numberDouble:Object.is(t,-0)?"-0.0":t.toString()}}if("bigint"==typeof t)return n.relaxed?Number(BigInt.asIntN(64,t)):{$numberLong:BigInt.asIntN(64,t).toString()};if(t instanceof RegExp||a(t)){let e=t.flags;if(void 0===e){let n=t.toString().match(/[gimuy]*$/);n&&(e=n[0])}let r=new eR(t.source,e);return r.toExtendedJSON(n)}return null!=t&&"object"==typeof t?function(t,n){if(null==t||"object"!=typeof t)throw new K("not an object instance");let r=t._bsontype;if(void 0===r){let r={};for(let i of Object.keys(t)){n.seenObjects.push({propertyName:i,obj:null});try{let o=e(t[i],n);"__proto__"===i?Object.defineProperty(r,i,{value:o,writable:!0,enumerable:!0,configurable:!0}):r[i]=o}finally{n.seenObjects.pop()}}return r}if(null!=t&&"object"==typeof t&&"string"==typeof t._bsontype&&5!==t[Symbol.for("@@mdb.bson.version")])throw new W;if(null!=t&&"object"==typeof t&&"_bsontype"in t&&"string"==typeof t._bsontype){let i=t;if("function"!=typeof i.toExtendedJSON){let e=eP[t._bsontype];if(!e)throw new K("Unrecognized or invalid _bsontype: "+t._bsontype);i=e(i)}return"Code"===r&&i.scope?i=new eg(i.code,e(i.scope,n)):"DBRef"===r&&i.oid&&(i=new ec(e(i.collection,n),e(i.oid,n),e(i.db,n),e(i.fields,n))),i.toExtendedJSON(n)}throw new K("_bsontype must be a string, but was: "+typeof r)}(t,n):t}(e,i);return JSON.stringify(o,t,n)}let eK=Object.create(null);eK.parse=k,eK.stringify=C,eK.serialize=function(e,t){return t=t||{},JSON.parse(C(e,t))},eK.deserialize=function(e,t){return t=t||{},k(JSON.stringify(e),t)},Object.freeze(eK);let eW=ei.allocate(17825792);var Y=Object.freeze({__proto__:null,Code:eg,BSONSymbol:eD,DBRef:ec,Binary:ea,ObjectId:eA,UUID:eh,Long:ey,Timestamp:eM,Double:eE,Int32:eU,MinKey:eI,MaxKey:eL,BSONRegExp:eR,Decimal128:e$,setInternalBufferSize:function(e){eW.length<e&&(eW=ei.allocate(e))},serialize:function(e,t={}){let n="boolean"==typeof t.checkKeys&&t.checkKeys,r="boolean"==typeof t.serializeFunctions&&t.serializeFunctions,i="boolean"!=typeof t.ignoreUndefined||t.ignoreUndefined,o="number"==typeof t.minInternalBufferSize?t.minInternalBufferSize:17825792;eW.length<o&&(eW=ei.allocate(o));let s=H(eW,e,n,0,0,r,i,null),l=ei.allocate(s);return l.set(eW.subarray(0,s),0),l},serializeWithBufferAndIndex:function(e,t,n={}){let r="boolean"==typeof n.checkKeys&&n.checkKeys,i="boolean"==typeof n.serializeFunctions&&n.serializeFunctions,o="boolean"!=typeof n.ignoreUndefined||n.ignoreUndefined,s="number"==typeof n.index?n.index:0,l=H(eW,e,r,0,0,i,o,null);return t.set(eW.subarray(0,l),s),s+l-1},deserialize:function(e,t={}){return w(ei.toLocalBufferType(e),t)},calculateObjectSize:function(e,t={}){t=t||{};let n="boolean"==typeof t.serializeFunctions&&t.serializeFunctions,r="boolean"!=typeof t.ignoreUndefined||t.ignoreUndefined;return m(e,n,r)},deserializeStream:function(e,t,n,r,i,o){let s=Object.assign({allowObjectSmallerThanBufferSize:!0,index:0},o),l=ei.toLocalBufferType(e),f=t;for(let e=0;e<n;e++){let t=l[f]|l[f+1]<<8|l[f+2]<<16|l[f+3]<<24;s.index=f,r[i+e]=w(l,s),f+=t}return f},BSONValue:eu,BSONError:K,BSONVersionError:W,BSONRuntimeError:G,BSONType:P,EJSON:eK});r()}catch(e){r(e)}},1)}}]);